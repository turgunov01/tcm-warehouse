import{_ as w,a as E}from"./89_6_WXE.js";import{_ as C}from"./CKHeMAGH.js";import{_ as L}from"./CeTMl5KV.js";import{_ as S}from"./Bg2tV3qA.js";import{_ as T}from"./LHM2B4W_.js";import{e as q,h as B,j as D,q as N,c as h,a as _,b as a,w as o,r as m,o as F,s as f,l as c,d as i,t as u}from"./C3nFx1By.js";import{u as R}from"./BOtwTEl-.js";import"./DLtK76PB.js";import"./vTvZ5yAG.js";import"./zCT-49bZ.js";import"./BNwErHV-.js";const I={class:"space-y-4"},M={class:"grid gap-3 md:grid-cols-3"},j={class:"flex items-end"},Y=q({__name:"audit",setup(A){const x=B(),{actionLabel:v,tableLabel:k}=R(),d=m([]),l=m(""),n=m(""),r=async()=>{let s=x.from("audit_logs").select("*").order("created_at",{ascending:!1}).limit(300);l.value&&(s=s.eq("table_name",l.value)),n.value&&(s=s.eq("action",n.value));const{data:t}=await s;d.value=t??[]};return D(r),N([l,n],r),(s,t)=>{const y=E,p=w,U=C,V=L,b=S,g=T;return F(),h("div",I,[t[2]||(t[2]=_("div",null,[_("h1",{class:"text-2xl font-semibold"},"Журнал аудита"),_("p",{class:"text-sm text-slate-500"},"Отслеживание изменений в ключевых таблицах.")],-1)),a(b,null,{default:o(()=>[_("div",M,[a(p,{label:"Таблица"},{default:o(()=>[a(y,{modelValue:c(l),"onUpdate:modelValue":t[0]||(t[0]=e=>f(l)?l.value=e:null),placeholder:"bookings"},null,8,["modelValue"])]),_:1}),a(p,{label:"Действие"},{default:o(()=>[a(U,{modelValue:c(n),"onUpdate:modelValue":t[1]||(t[1]=e=>f(n)?n.value=e:null),options:["","INSERT","UPDATE","DELETE"]},null,8,["modelValue"])]),_:1}),_("div",j,[a(V,{label:"Обновить",onClick:r})])])]),_:1}),a(b,null,{default:o(()=>[a(g,{rows:c(d),columns:[{key:"created_at",label:"Время"},{key:"table_name",label:"Таблица"},{key:"action",label:"Действие"},{key:"record_id",label:"Запись"},{key:"actor_id",label:"Кто изменил"}]},{"created_at-data":o(({row:e})=>[i(u(new Date(e.created_at).toLocaleString()),1)]),"table_name-data":o(({row:e})=>[i(u(c(k)(e.table_name)),1)]),"action-data":o(({row:e})=>[i(u(c(v)(e.action)),1)]),_:1},8,["rows"])]),_:1})])}}});export{Y as default};
