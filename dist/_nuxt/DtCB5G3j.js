import{_ as q}from"./CeTMl5KV.js";import{_ as z}from"./LHM2B4W_.js";import{_ as w}from"./Bg2tV3qA.js";import{e as T,h,z as B,j as D,c as N,a as n,t as c,l as i,b as o,w as l,n as v,r as f,o as $,d as g}from"./C3nFx1By.js";import{u as L}from"./BOtwTEl-.js";import"./zCT-49bZ.js";import"./DLtK76PB.js";import"./BNwErHV-.js";const R={class:"space-y-4"},U={class:"flex items-center justify-between"},V={class:"text-sm text-slate-500"},j={class:"flex gap-1"},G=T({__name:"bookings",setup(E){const d=h(),r=B("guard-zone",()=>null),{bookingStatusLabel:k}=L(),m=f([]),_=f(""),x=()=>{const e=new Date;return e.setHours(0,0,0,0),e.toISOString()},y=()=>{const e=new Date;return e.setHours(23,59,59,999),e.toISOString()},p=async()=>{if(!r.value){await v("/guard");return}const[e,a]=await Promise.all([d.from("zones").select("name").eq("id",r.value).single(),d.from("bookings").select("*").eq("zone_id",r.value).gte("requested_datetime",x()).lte("requested_datetime",y()).in("status",["approved","arrived","left","completed"]).order("requested_datetime")]);_.value=e.data?.name||"",m.value=a.data??[]},u=async(e,a)=>{const{error:s}=await d.from("bookings").update({status:a}).eq("id",e.id);s||await p()};return D(p),(e,a)=>{const s=q,C=z,S=w;return $(),N("div",R,[n("div",U,[n("div",null,[a[1]||(a[1]=n("h1",{class:"text-2xl font-semibold"},"Бронирования на сегодня",-1)),n("p",V,"Зона: "+c(i(_)||"Не выбрана"),1)]),o(s,{label:"Сменить зону",variant:"outline",onClick:a[0]||(a[0]=t=>("navigateTo"in e?e.navigateTo:i(v))("/guard"))})]),o(S,null,{default:l(()=>[o(C,{rows:i(m),columns:[{key:"requested_datetime",label:"Слот"},{key:"driver_name",label:"Водитель"},{key:"car_plate_text",label:"Номер"},{key:"status",label:"Статус"},{key:"overtime_minutes",label:"Переработка (мин)"},{key:"actions",label:"Действия"}]},{"requested_datetime-data":l(({row:t})=>[g(c(new Date(t.requested_datetime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),1)]),"status-data":l(({row:t})=>[g(c(i(k)(t.status)),1)]),"actions-data":l(({row:t})=>[n("div",j,[o(s,{size:"2xs",label:"Прибыл",disabled:t.status!=="approved",onClick:b=>u(t,"arrived")},null,8,["disabled","onClick"]),o(s,{size:"2xs",label:"Выехал",disabled:t.status!=="arrived",onClick:b=>u(t,"left")},null,8,["disabled","onClick"]),o(s,{size:"2xs",label:"Завершено",disabled:t.status!=="left",onClick:b=>u(t,"completed")},null,8,["disabled","onClick"])])]),_:1},8,["rows"])]),_:1})])}}});export{G as default};
