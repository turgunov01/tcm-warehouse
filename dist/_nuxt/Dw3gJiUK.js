import{_ as L}from"./Doh9g-xE.js";import{_ as D}from"./Bj5gw5IS.js";import{_ as I}from"./DtwZo4z0.js";import{_ as R}from"./WaFNkPel.js";import{_ as j}from"./CeTMl5KV.js";import{_ as A}from"./LHM2B4W_.js";import{_ as E}from"./Bg2tV3qA.js";import{e as F,h as M,j as W,q as G,c as g,a as _,l as t,v as x,m as H,b as n,s as J,w as i,r as l,o as p,d as y,t as B}from"./C3nFx1By.js";import{u as K}from"./YQB72Io7.js";import{u as O}from"./BOtwTEl-.js";import"./CKHeMAGH.js";import"./vTvZ5yAG.js";import"./DLtK76PB.js";import"./89_6_WXE.js";import"./zCT-49bZ.js";import"./BNwErHV-.js";const P={class:"space-y-4"},Q={key:0},X={class:"flex gap-2"},fe=F({__name:"bookings",setup(Y){const v=M(),{fetchBookings:C}=K(),{bookingStatusLabel:h}=O(),f=l(!1),b=l([]),r=l(""),o=l({from:"",to:"",statuses:[]}),u=l(null),c=l(null),U=[{key:"requested_datetime",label:"Запрошено"},{key:"status",label:"Статус"},{key:"driver_name",label:"Водитель"},{key:"car_plate_text",label:"Номер"},{key:"tenant",label:"Арендатор"},{key:"zone_id",label:"Зона"},{key:"actions",label:"Действия"}],m=async()=>{f.value=!0,b.value=await C({from:o.value.from?`${o.value.from}T00:00:00`:void 0,to:o.value.to?`${o.value.to}T23:59:59`:void 0,statuses:o.value.statuses}),f.value=!1},V=async s=>{u.value=s.id;const{error:a}=await v.from("bookings").update({status:"approved"}).eq("id",s.id);r.value=a?a.message:"Бронирование одобрено.",u.value=null,await m()},q=async s=>{if(!confirm("Удалить это бронирование? Действие нельзя отменить."))return;c.value=s.id;const{error:d}=await v.from("bookings").delete().eq("id",s.id);r.value=d?d.message:"Бронирование удалено.",c.value=null,await m()};return W(m),G(o,m,{deep:!0}),(s,a)=>{const d=L,$=D,S=I,N=R,k=j,T=A,w=E;return p(),g("div",P,[a[1]||(a[1]=_("div",null,[_("h1",{class:"text-2xl font-semibold"},"Бронирования"),_("p",{class:"text-sm text-slate-500"},"Одобрение и удаление заявок арендаторов.")],-1)),t(r)?(p(),x(d,{key:0,title:t(r),color:"primary",variant:"subtle"},null,8,["title"])):H("",!0),n($,{modelValue:t(o),"onUpdate:modelValue":a[0]||(a[0]=e=>J(o)?o.value=e:null)},null,8,["modelValue"]),n(w,null,{default:i(()=>[t(f)?(p(),g("div",Q,[n(S,{class:"h-40"})])):(p(),x(T,{key:1,rows:t(b),columns:U},{"requested_datetime-data":i(({row:e})=>[y(B(new Date(e.requested_datetime).toLocaleString()),1)]),"status-data":i(({row:e})=>[n(N,{label:t(h)(e.status),color:"gray",variant:"subtle"},null,8,["label"])]),"tenant-data":i(({row:e})=>[y(B(e.profiles?.full_name||e.tenant_id),1)]),"actions-data":i(({row:e})=>[_("div",X,[n(k,{size:"xs",label:"Одобрить",loading:t(u)===e.id,disabled:e.status==="approved"||t(c)===e.id,onClick:z=>V(e)},null,8,["loading","disabled","onClick"]),n(k,{size:"xs",label:"Удалить",color:"red",variant:"outline",loading:t(c)===e.id,disabled:t(u)===e.id,onClick:z=>q(e)},null,8,["loading","disabled","onClick"])])]),_:1},8,["rows"]))]),_:1})])}}});export{fe as default};
