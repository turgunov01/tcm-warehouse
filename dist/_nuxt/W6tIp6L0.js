import{u as K,_ as Q,a as X}from"./Dxqsq03p.js";import{_ as S}from"./CeTMl5KV.js";import{_ as T}from"./Bg2tV3qA.js";import{u as F}from"./BOtwTEl-.js";import{e as A,j as D,v as $,w as b,r,o as i,a,c as m,x as Y,F as Z,m as j,b as t,t as k,l as e,h as ee,q as te,s as M,y as w}from"./C3nFx1By.js";import{_ as oe}from"./Bj5gw5IS.js";import{_ as se}from"./CKHeMAGH.js";import{_ as ae}from"./89_6_WXE.js";import{_ as ne,a as le,b as ie}from"./CDRKptRF.js";import{_ as re}from"./DtwZo4z0.js";import{u as ue}from"./YQB72Io7.js";import"./zCT-49bZ.js";import"./BNwErHV-.js";import"./vTvZ5yAG.js";import"./DLtK76PB.js";import"./WaFNkPel.js";import"./LHM2B4W_.js";const ce={class:"flex items-center justify-between gap-2"},_e={class:"text-sm text-slate-900"},de={class:"text-xs text-slate-500"},me={key:0,class:"text-sm text-slate-500"},pe={key:0,class:"mt-3 flex justify-end"},fe=A({__name:"ActivityFeed",props:{items:{},showMoreTo:{default:""},showMoreLabel:{default:"Показать еще"}},setup(B){const{actionLabel:y,tableLabel:h}=F(),p=r(null),u=B,{staggerList:f}=K();return D(async()=>{p.value&&await f(p.value,".activity-item",{stagger:.07,duration:.25})}),(c,s)=>{const _=S,x=T;return i(),$(x,null,{header:b(()=>[...s[0]||(s[0]=[a("p",{class:"font-semibold"},"Последняя активность",-1)])]),default:b(()=>[a("div",{ref_key:"feed",ref:p,class:"space-y-2"},[(i(!0),m(Z,null,Y(u.items,n=>(i(),m("div",{key:n.id,class:"activity-item rounded border border-[#eeeeee] p-3"},[a("div",ce,[a("p",_e,k(e(y)(n.action))+": "+k(e(h)(n.table_name)),1),a("p",de,k(new Date(n.created_at).toLocaleString()),1)])]))),128)),u.items.length?j("",!0):(i(),m("p",me,"Пока нет активности."))],512),u.showMoreTo?(i(),m("div",pe,[t(_,{size:"xs",variant:"outline",color:"white",label:u.showMoreLabel,to:u.showMoreTo},null,8,["label","to"])])):j("",!0)]),_:1})}}}),ve={class:"space-y-4"},be={class:"card-grid"},xe={class:"grid gap-4 xl:grid-cols-[2fr_1fr]"},ge={class:"grid gap-4"},we={class:"flex flex-col gap-3 md:flex-row md:items-end md:justify-between"},ye={key:0},Re=A({__name:"index",setup(B){const y=ee(),{fetchBookings:h,fetchRecentActivity:p}=ue(),{bookingStatusLabel:u}=F(),f=r(!0),c=r("table"),s=r({from:"",to:"",statuses:[]}),_=r([]),x=r([]),n=r([]),C=r([]),d=w(()=>{const l={pending:0,approved:0,rejected:0,completed:0};for(const o of _.value)l[o.status]!==void 0&&(l[o.status]+=1);return l}),G=w(()=>Object.keys(d.value).map(l=>u(l))),N=w(()=>Object.values(d.value)),L=w(()=>n.value.length?_.value.filter(l=>n.value.includes(l.tenant_id)):_.value),U=async()=>{f.value=!0,_.value=await h({from:s.value.from?`${s.value.from}T00:00:00`:void 0,to:s.value.to?`${s.value.to}T23:59:59`:void 0,statuses:s.value.statuses}),C.value=await p(5),f.value=!1};return D(async()=>{const{data:l}=await y.from("profiles").select("id, full_name").eq("role","tenant").order("full_name");x.value=l??[],await U()}),te(s,U,{deep:!0}),(l,o)=>{const g=Q,R=X,q=fe,O=oe,z=se,E=ae,V=S,P=ie,W=T,H=re,I=ne,J=le;return i(),m("div",ve,[o[4]||(o[4]=a("div",null,[a("h1",{class:"text-2xl font-semibold"},"Панель администратора"),a("p",{class:"text-sm text-slate-500"},"Обзор склада, бронирований и активности.")],-1)),a("div",be,[t(g,{label:"В ожидании",value:e(d).pending,tone:"warning"},null,8,["value"]),t(g,{label:"Одобрено",value:e(d).approved,tone:"success"},null,8,["value"]),t(g,{label:"Отклонено",value:e(d).rejected,tone:"danger"},null,8,["value"]),t(g,{label:"Завершено",value:e(d).completed},null,8,["value"])]),a("div",xe,[t(R,{title:"Распределение статусов",labels:e(G),values:e(N)},null,8,["labels","values"]),t(q,{items:e(C),"show-more-to":"/admin/audit"},null,8,["items"])]),a("div",ge,[t(O,{modelValue:e(s),"onUpdate:modelValue":o[0]||(o[0]=v=>M(s)?s.value=v:null)},null,8,["modelValue"]),t(W,null,{default:b(()=>[a("div",we,[t(E,{label:"Фильтр по арендатору",class:"w-full md:max-w-md"},{default:b(()=>[t(z,{modelValue:e(n),"onUpdate:modelValue":o[1]||(o[1]=v=>M(n)?n.value=v:null),options:e(x),"option-attribute":"full_name","value-attribute":"id",multiple:"",searchable:""},null,8,["modelValue","options"])]),_:1}),t(P,null,{default:b(()=>[t(V,{label:"Таблица",variant:e(c)==="table"?"solid":"outline",onClick:o[2]||(o[2]=v=>c.value="table")},null,8,["variant"]),t(V,{label:"Календарь",variant:e(c)==="calendar"?"solid":"outline",onClick:o[3]||(o[3]=v=>c.value="calendar")},null,8,["variant"])]),_:1})])]),_:1}),e(f)?(i(),m("div",ye,[t(H,{class:"h-44"})])):e(c)==="table"?(i(),$(I,{key:1,rows:e(L)},null,8,["rows"])):(i(),$(J,{key:2,rows:e(L)},null,8,["rows"]))])])}}});export{Re as default};
