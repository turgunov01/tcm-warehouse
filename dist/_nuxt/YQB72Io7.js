import{h as o,U as c}from"./C3nFx1By.js";const l=()=>{const n=o(),i=c();return{fetchSettings:async()=>{const{data:t}=await n.from("settings").select("*").eq("id",1).single();return t},fetchZones:async()=>{const{data:t}=await n.from("zones").select("*").order("name");return t??[]},fetchBookings:async(t={})=>{let e=n.from("bookings").select("*, profiles!bookings_tenant_id_fkey(id, full_name, tenant_code)").order("requested_datetime",{ascending:!1});t.from&&(e=e.gte("requested_datetime",t.from)),t.to&&(e=e.lte("requested_datetime",t.to)),t.statuses?.length&&(e=e.in("status",t.statuses)),t.tenantIds?.length&&(e=e.in("tenant_id",t.tenantIds)),t.zoneId&&(e=e.eq("zone_id",t.zoneId));const{data:s,error:a}=await e;if(a)throw a;return s??[]},fetchRecentActivity:async(t=10)=>{const{data:e}=await n.from("audit_logs").select("*").order("created_at",{ascending:!1}).limit(t);return e??[]},fetchNotifications:async()=>{if(!i.value)return[];const{data:t}=await n.from("notifications").select("*, notification_reads(user_id, read_at)").or(`recipient_id.is.null,recipient_id.eq.${i.value.id}`).order("created_at",{ascending:!1});return t??[]},markNotificationRead:async t=>{await n.from("notification_reads").upsert({notification_id:t})},fetchTenantDebt:async t=>{const e=t||i.value?.id;if(!e)return 0;const{data:s,error:a}=await n.rpc("tenant_debt",{p_tenant_id:e});return a?0:Number(s??0)}}};export{l as u};
