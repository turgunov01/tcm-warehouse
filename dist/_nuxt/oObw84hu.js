import{_ as D}from"./CeTMl5KV.js";import{_ as j}from"./LHM2B4W_.js";import{_ as q}from"./Bg2tV3qA.js";import{_ as N}from"./Bp_7xjuY.js";import{e as L,h as E,U as M,q as w,j as R,c as a,a as o,b as _,w as p,s as T,l as t,r as m,o as r,d as k,t as f,m as U,p as z}from"./C3nFx1By.js";import{u as I}from"./YQB72Io7.js";import{u as W}from"./BOtwTEl-.js";import"./zCT-49bZ.js";import"./DLtK76PB.js";import"./BNwErHV-.js";import"./vTvZ5yAG.js";const $={class:"space-y-4"},A={key:0,class:"space-y-3 text-sm"},G={class:"grid gap-3 md:grid-cols-2"},H=["src"],J={key:1},K={key:2},O=["src"],Q={key:1},X={key:2},Y=["src"],Z={key:1},ee={key:2},te={key:0,class:"text-red-600"},fe=L({__name:"history",setup(se){const P=E(),v=M(),{fetchBookings:C}=I(),{bookingStatusLabel:F}=W(),y=m([]),b=m(null),d=m(!1),u=m(!1),i=m(""),s=z({passportFront:"",passportBack:"",platePhoto:""}),x=async()=>{if(!v.value?.id){y.value=[];return}y.value=await C({tenantIds:[v.value.id]})},h=async n=>{if(!n)return"";const{data:e,error:c}=await P.storage.from("documents").createSignedUrl(n,1800);return c?"":e?.signedUrl||""},S=async n=>{b.value=n,d.value=!0,i.value="",u.value=!0;try{const[e,c,g]=await Promise.all([h(n.driver_passport_front),h(n.driver_passport_back),h(n.car_plate_photo)]);s.passportFront=e,s.passportBack=c,s.platePhoto=g}catch{i.value="Не удалось загрузить предпросмотр документов.",s.passportFront="",s.passportBack="",s.platePhoto=""}finally{u.value=!1}};return w(d,n=>{n||(i.value="",s.passportFront="",s.passportBack="",s.platePhoto="")}),R(x),w(()=>v.value?.id,()=>{x()}),(n,e)=>{const c=D,g=j,B=q,V=N;return r(),a("div",$,[e[7]||(e[7]=o("div",null,[o("h1",{class:"text-2xl font-semibold"},"История"),o("p",{class:"text-sm text-slate-500"},"Все прошлые бронирования и предпросмотр документов водителя.")],-1)),_(B,null,{default:p(()=>[_(g,{rows:t(y),columns:[{key:"requested_datetime",label:"Дата"},{key:"status",label:"Статус"},{key:"driver_name",label:"Водитель"},{key:"actions",label:"Действия"}]},{"status-data":p(({row:l})=>[k(f(t(F)(l.status)),1)]),"requested_datetime-data":p(({row:l})=>[k(f(new Date(l.requested_datetime).toLocaleString()),1)]),"actions-data":p(({row:l})=>[_(c,{size:"xs",label:"Просмотр",onClick:oe=>S(l)},null,8,["onClick"])]),_:1},8,["rows"])]),_:1}),_(V,{modelValue:t(d),"onUpdate:modelValue":e[0]||(e[0]=l=>T(d)?d.value=l:null)},{default:p(()=>[_(B,null,{header:p(()=>[...e[1]||(e[1]=[o("p",{class:"font-semibold"},"Данные водителя",-1)])]),default:p(()=>[t(b)?(r(),a("div",A,[o("p",null,[e[2]||(e[2]=o("strong",null,"Имя:",-1)),k(" "+f(t(b).driver_name),1)]),o("p",null,[e[3]||(e[3]=o("strong",null,"Номер машины:",-1)),k(" "+f(t(b).car_plate_text),1)]),o("div",G,[o("div",null,[e[4]||(e[4]=o("p",{class:"mb-1 font-semibold"},"Паспорт (лицевая сторона)",-1)),t(s).passportFront?(r(),a("img",{key:0,src:t(s).passportFront,alt:"Паспорт лицевая сторона",class:"h-44 w-full rounded border border-[#eeeeee] object-cover"},null,8,H)):t(u)?(r(),a("p",J,"Загрузка...")):(r(),a("p",K,"Предпросмотр недоступен."))]),o("div",null,[e[5]||(e[5]=o("p",{class:"mb-1 font-semibold"},"Паспорт (обратная сторона)",-1)),t(s).passportBack?(r(),a("img",{key:0,src:t(s).passportBack,alt:"Паспорт обратная сторона",class:"h-44 w-full rounded border border-[#eeeeee] object-cover"},null,8,O)):t(u)?(r(),a("p",Q,"Загрузка...")):(r(),a("p",X,"Предпросмотр недоступен."))])]),o("div",null,[e[6]||(e[6]=o("p",{class:"mb-1 font-semibold"},"Фото госномера",-1)),t(s).platePhoto?(r(),a("img",{key:0,src:t(s).platePhoto,alt:"Фото госномера",class:"h-44 w-full rounded border border-[#eeeeee] object-cover"},null,8,Y)):t(u)?(r(),a("p",Z,"Загрузка...")):(r(),a("p",ee,"Предпросмотр недоступен."))]),t(i)?(r(),a("p",te,f(t(i)),1)):U("",!0)])):U("",!0)]),_:1})]),_:1},8,["modelValue"])])}}});export{fe as default};
